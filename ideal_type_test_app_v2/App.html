// ì´ìƒí˜• í…ŒìŠ¤íŠ¸ ì›¹ì•± - ìŠ¬ë¼ì´ë“œ í˜•ì‹, ê²°ê³¼ ìš”ì•½ í¬í•¨
// ê¸°ìˆ  ìŠ¤íƒ: React + TailwindCSS + html2canvas (ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥ìš©)

import React, { useState } from 'react';
import html2canvas from 'html2canvas';

const questions = [
  {
    question: 'ì´ìƒí˜•ì˜ ì–¼êµ´ ë¶„ìœ„ê¸°ëŠ”?',
    options: [
      { text: 'ë‚ ì¹´ë¡­ê³  ë˜ë ·í•œ ì¸ìƒ', code: 'SHRP' },
      { text: 'ë¶€ë“œëŸ½ê³  ìˆœí•œ ì¸ìƒ', code: 'SOFT' },
      { text: 'ê·€ì—½ê³  ì•³ëœ ëŠë‚Œ', code: 'CUTE' },
      { text: 'ì‹ ë¹„ë¡­ê³  ë¬˜í•œ ë¶„ìœ„ê¸°', code: 'MYST' },
    ],
  },
  {
    question: 'ëˆˆì´ ê°€ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì€?',
    options: [
      { text: 'ê¹”ë”í•œ ë‹¨ì •í•œ ìŠ¤íƒ€ì¼', code: 'NEAT' },
      { text: 'ìì—°ìŠ¤ëŸ½ê³  ë¶€ìŠ¤ìŠ¤í•œ ëŠë‚Œ', code: 'FREE' },
      { text: 'ë°ì€ ì—¼ìƒ‰ë¨¸ë¦¬ë‚˜ íŒŒê²© ìŠ¤íƒ€ì¼', code: 'BOLD' },
      { text: 'ê¸´ ë¨¸ë¦¬ or ì›¨ì´ë¸Œ', code: 'FLOW' },
    ],
  },
  {
    question: 'í‚¤ì™€ ì²´í˜• ì¤‘ì— ë” ëŒë¦¬ëŠ” ê±´?',
    options: [
      { text: 'í‚¤ í° ëª¨ë¸í•', code: 'TALL' },
      { text: 'ì•„ë‹´í•˜ê³  ê·€ì—¬ìš´ ì²´í˜•', code: 'PETI' },
      { text: 'ìš´ë™ìœ¼ë¡œ ë‹¤ì ¸ì§„ ëª¸', code: 'FITB' },
      { text: 'ì²´í˜•ë³´ë‹¤ ì „ì²´ ë¹„ìœ¨', code: 'PROP' },
    ],
  },
  {
    question: 'ë§íˆ¬ì—ì„œ ëŒë¦¬ëŠ” í¬ì¸íŠ¸ëŠ”?',
    options: [
      { text: 'ë‚˜ê¸‹ë‚˜ê¸‹í•˜ê³  ì°¨ë¶„í•œ ë§íˆ¬', code: 'CALM' },
      { text: 'í™œë°œí•˜ê³  ë°ì€ ë§íˆ¬', code: 'BRIT' },
      { text: 'ìœ ë¨¸ëŸ¬ìŠ¤í•˜ê²Œ íˆ­íˆ­ ë˜ì§€ëŠ” ë§íˆ¬', code: 'WITY' },
      { text: 'ì§„ì¤‘í•˜ê³  ì§„ì‹¬ ì–´ë¦° ë§íˆ¬', code: 'DEEP' },
    ],
  },
  {
    question: 'ì„±ê²©ì ìœ¼ë¡œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†ŒëŠ”?',
    options: [
      { text: 'ì„¼ìŠ¤ ìˆê³  ë§ì´ ì˜ í†µí•˜ëŠ” ì‚¬ëŒ', code: 'CHRM' },
      { text: 'ë‚˜ë§Œ ë°”ë¼ë³´ëŠ” ë‹¤ì •í•œ ì‚¬ëŒ', code: 'LOVL' },
      { text: 'ìê¸° ì¼ì— ì—´ì • ìˆëŠ” ì‚¬ëŒ', code: 'PASS' },
      { text: 'ì¡°ìš©í•˜ì§€ë§Œ ê¹Šì´ ìˆëŠ” ì‚¬ëŒ', code: 'INTR' },
    ],
  },
  {
    question: 'íŒ¨ì…˜ ìŠ¤íƒ€ì¼ì—ì„œ ê°€ì¥ ëŒë¦¬ëŠ” ê±´?',
    options: [
      { text: 'ë¯¸ë‹ˆë©€í•˜ê³  ì„¸ë ¨ëœ ìŠ¤íƒ€ì¼', code: 'CLAS' },
      { text: 'ìºì£¼ì–¼í•˜ê³  í¸ì•ˆí•œ ëŠë‚Œ', code: 'CAZU' },
      { text: 'ìŠ¤íŠ¸ë¦¿ & íŠ¸ë Œë””í•œ íŒ¨ì…˜', code: 'STRT' },
      { text: 'í´ë˜ì‹í•˜ê³  ê¹”ë”í•œ ë£©', code: 'NEAT' },
    ],
  },
  {
    question: 'ì·¨ë¯¸ê°€ ê°™ë‹¤ë©´ ì–´ë–¤ ê²Œ ì œì¼ ì¢‹ì•„?',
    options: [
      { text: 'ìŒì•…, ì˜í™” ê°™ì´ ê°ìƒí•˜ê¸°', code: 'ARTY' },
      { text: 'ì‚°ì±…, ì—¬í–‰ ë‹¤ë‹ˆê¸°', code: 'MOVE' },
      { text: 'ê²Œì„, ìœ íŠœë¸Œ ê°™ì´ ë³´ê¸°', code: 'CHIL' },
      { text: 'ìƒˆë¡œìš´ ê±¸ ë°°ìš°ê±°ë‚˜ ë§Œë“¤ê¸°', code: 'MAKR' },
    ],
  },
  {
    question: 'ëª©ì†Œë¦¬ íƒ€ì… ì¤‘ ê°€ì¥ ë§¤ë ¥ì ì¸ ê±´?',
    options: [
      { text: 'ì €ìŒì˜ ì•ˆì •ì ì¸ ëª©ì†Œë¦¬', code: 'DVOX' },
      { text: 'ë°ê³  ì²­ëŸ‰í•œ ëª©ì†Œë¦¬', code: 'CLER' },
      { text: 'ì¤‘ì €ìŒì˜ ë§íˆ¬ê°€ ì„¹ì‹œí•œ ëª©ì†Œë¦¬', code: 'SMEX' },
      { text: 'ê·€ì—½ê³  ë°œë„í•œ ëŠë‚Œ', code: 'SWTY' },
    ],
  },
  {
    question: 'ì§‘ì—ì„œ ë³¸ë‹¤ë©´ ì–´ë–¤ í–‰ë™ì— ëŒë¦´ê¹Œ?',
    options: [
      { text: 'ìš”ë¦¬í•˜ëŠ” ëª¨ìŠµ', code: 'COOK' },
      { text: 'í¸í•˜ê²Œ ëˆ„ì›ŒìˆëŠ” ëª¨ìŠµ', code: 'LAZY' },
      { text: 'ì²­ì†Œë‚˜ ì •ë¦¬ì •ëˆí•˜ëŠ” ëª¨ìŠµ', code: 'TIDY' },
      { text: 'ì§‘ì¤‘í•´ì„œ ë­”ê°€ì— ëª°ë‘í•˜ëŠ” ëª¨ìŠµ', code: 'FOCU' },
    ],
  },
  {
    question: 'ê°€ì¥ ëŒë¦¬ëŠ” ì²«ì¸ìƒ í¬ì¸íŠ¸ëŠ”?',
    options: [
      { text: 'ëˆˆë¹›', code: 'EYES' },
      { text: 'ëª©ì†Œë¦¬', code: 'VOIC' },
      { text: 'ì›ƒëŠ” ëª¨ìŠµ', code: 'SMIL' },
      { text: 'ì „ì²´ì ì¸ ë¶„ìœ„ê¸°', code: 'AURA' },
    ],
  },
];

export default function IdealTypeTest() {
  const [step, setStep] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [summary, setSummary] = useState('');

  const handleAnswer = (code) => {
    const updatedAnswers = [...answers, code];
    setAnswers(updatedAnswers);
    if (step === questions.length - 1) {
      generateSummary(updatedAnswers);
    }
    setStep(step + 1);
  };

  const generateSummary = (codes) => {
    const pick = (keyword) => codes.find(c => c === keyword);
    const parts = [];
    if (pick('CUTE') || pick('SOFT')) parts.push('ê·€ì—½ê³  ë¶€ë“œëŸ¬ìš´ ì‚¬ëŒ');
    if (pick('SHRP') || pick('MYST')) parts.push('ì‹ ë¹„ë¡­ê³  ê°•ë ¬í•œ ì¸ìƒ');
    if (pick('CLER') || pick('BRIT') || pick('SMIL')) parts.push('ë°ê³  ì˜ ì›ƒëŠ” ìŠ¤íƒ€ì¼');
    if (pick('LOVL') || pick('CHRM')) parts.push('ë‹¤ì •í•˜ê³  ì„¼ìŠ¤ ìˆëŠ” ì„±ê²©');
    if (pick('LAZY') || pick('CHIL')) parts.push('í¸í•˜ê²Œ ê°™ì´ ì‰´ ìˆ˜ ìˆëŠ” ì‚¬ëŒ');
    if (pick('PASS') || pick('FOCU')) parts.push('ìê¸° ì¼ì— ì§‘ì¤‘í•˜ëŠ” ì‚¬ëŒ');

    const sentence = `ë„ˆ ${parts.join(', ')} ì¢‹ì•„í•˜ì–ì•„~ ì™„ì „ ë„ˆ ì·¨í–¥ì´ì§€!`;
    setSummary(sentence);
  };

  const handleDownload = async () => {
    const resultDiv = document.getElementById('result');
    const canvas = await html2canvas(resultDiv);
    const link = document.createElement('a');
    link.download = 'ideal-type.png';
    link.href = canvas.toDataURL();
    link.click();
  };

  const shareToSNS = (platform) => {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent(summary);
    if (platform === 'x') {
      window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`);
    } else if (platform === 'insta') {
      alert('ì¸ìŠ¤íƒ€ê·¸ë¨ì€ ë¸Œë¼ìš°ì € ê³µìœ ë¥¼ ì§ì ‘ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•´ì„œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!');
    }
  };

  const generateAIImage = () => {
    alert('âœ¨ AI ì´ìƒí˜• ì´ë¯¸ì§€ ìƒì„± ê¸°ëŠ¥ì€ ê³§ ì—°ê²°ë©ë‹ˆë‹¤! ì§€ê¸ˆì€ í”„ë¡œí† íƒ€ì…ì…ë‹ˆë‹¤ :)');
  };

  if (step >= questions.length) {
    return (
      <div id="result" className="p-6 text-center space-y-4">
        <h1 className="text-2xl font-bold">ğŸ¯ ë„ˆì˜ ì´ìƒí˜• ìš”ì•½</h1>
        <p className="text-lg">{summary}</p>
        <p className="text-sm text-gray-500">ì½”ë“œ: {answers.join(' Â· ')}</p>
        <div className="space-x-2 mt-4">
          <button onClick={handleDownload} className="bg-blue-500 text-white px-4 py-2 rounded">ì´ë¯¸ì§€ ì €ì¥</button>
          <button onClick={() => shareToSNS('x')} className="bg-black text-white px-4 py-2 rounded">X ê³µìœ </button>
          <button onClick={() => shareToSNS('insta')} className="bg-pink-500 text-white px-4 py-2 rounded">ì¸ìŠ¤íƒ€ ì—…ë¡œë“œ</button>
        </div>
        <button onClick={generateAIImage} className="mt-4 border px-4 py-2 rounded-lg">âœ¨ AIë¡œ ì´ìƒí˜• ê·¸ë¦¬ê¸°</button>
      </div>
    );
  }

  return (
    <div className="flex flex-col items-center justify-center h-screen px-6">
      <div className="text-xl font-semibold mb-6">Q{step + 1}. {questions[step].question}</div>
      <div className="grid gap-4 w-full max-w-md">
        {questions[step].options.map((opt, idx) => (
          <button key={idx} onClick={() => handleAnswer(opt.code)} className="bg-white p-4 rounded-2xl shadow hover:bg-blue-50">
            {opt.text}
          </button>
        ))}
      </div>
    </div>
  );
}
